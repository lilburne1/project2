<!DOCTYPE html>
<html>
<head>
    <title>ROS Image Viewer</title>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/ros2djs/current/ros2d.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/nav2djs/current/nav2d.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/ros3djs/current/ros3d.min.js"></script>
</head>
<body>
    <h1>ROS Image Viewer</h1>
    <div id="image_container">
        <img id="ros_image" src=""/>
    </div>
    <script type="text/javascript">
        var ros = new ROSLIB.Ros({
            url: 'ws://localhost:9090'
        });

        ros.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
        });

        var listener = new ROSLIB.Topic({
            ros: ros,
            name: '/Cone_found_Web',
            messageType: 'sensor_msgs/Image'
        });

        listener.subscribe(function(message) {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            var imgData = ctx.createImageData(message.width, message.height);
            for (var i = 0; i < imgData.data.length; i += 4) {
                imgData.data[i] = message.data[i];
                imgData.data[i + 1] = message.data[i + 1];
                imgData.data[i + 2] = message.data[i + 2];
                imgData.data[i + 3] = 255; // Alpha channel
            }
            ctx.putImageData(imgData, 0, 0);
            document.getElementById('ros_image').src = canvas.toDataURL();
        });
    </script>
</body>
</html>
