<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
</head>

<body>
  <h1>Rosbridge</h1>

  <h2>Publish for Waypoints</h2>
  <form id="waypoints-form">
    <label for="number1">Waypoint 1:</label>
    <input type="text" id="waypoint1" name="waypoint1" value="0"><br>
    <label for="number2">Waypoint2 2:</label>
    <input type="text" id="waypoint2" name="waypoint2" value="0"><br>
    <label for="number3">Waypoint 3:</label>
    <input type="text" id="waypoint3" name="waitpoint3" value="0"><br>
  </form>

  <h2>Red/Yellow Objects Images</h2>
  <img id="ros-image" alt="Image from ROS" style="width: 640px; height: 480px; border: 1px solid black;" />

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>

  <script type="text/javascript" type="text/javascript">
    const ros = new ROSLIB.Ros({ url: "ws://localhost:9090" });

    // When the Rosbridge server connects, fill the span with id "status" with "successful"
    ros.on("connection", () => {
      document.getElementById("status").innerHTML = "successful";
    });

    // When the Rosbridge server experiences an error, fill the "status" span with the returned error
    ros.on("error", (error) => {
      document.getElementById("status").innerHTML = `errored out (${error})`;
    });

    // When the Rosbridge server shuts down, fill the "status" span with "closed"
    ros.on("close", () => {
      document.getElementById("status").innerHTML = "closed";
    });

    // Create a listener for /my_topic
    const imageTopic = new ROSLIB.Topic({
      ros,
      name: "/published_object",
      messageType: "sensor_msgs/Image"
    });

    // When we receive a message on /my_topic, add its data as a list item to the "messages" ul
    imageTopic.subscribe((message) => {
      const img = document.getElementById("ros-image");
      img.src = "data:image/jpeg;base64," + message.data;
    });

    const waypointTopic = new ROSLIB.Topic({
      ros,
      name: "/waypoints",
      messageType: "std_msgs/Float32MultiArray"
    });

    // Handle the form submission
    document.getElementById("waypoints-form").addEventListener("submit", (event) => {
      event.preventDefault();

      const number1 = parseFloat(document.getElementById("waypoint1").value);
      const number2 = parseFloat(document.getElementById("waypoint2").value);
      const number3 = parseFloat(document.getElementById("waypoint3").value);

      const numbers = new ROSLIB.Message({
        data: [number1, number2, number3]
      });

      numbersTopic.publish(numbers);
    });
  </script>
</body>

</html>
